<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artwork Display</title>
  <style>
    .loading-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 1.5rem;
      z-index: 1000;
    }

    .hidden {
      display: none;
    }

    .content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .content {
      text-align: center;
      color: white;
    }

    .title {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 1.2rem;
      color: #a0aec0;
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen bg-gray-900">
  <div id="loading" class="loading-screen">
    Loading, please wait...
  </div>

  <div class="wrapper hidden">
    <div class="content p-6">
      <h1 class="title">Today's Artwork</h1>
      <div id="artwork-details">
        <!-- Artwork details and image will be inserted here -->
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialize Supabase client
    const { createClient } = supabase;
    const _supabase = createClient(
      'https://kdcfufobafrpbwewcrst.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtkY2Z1Zm9iYWZycGJ3ZXdjcnN0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc3NjIzNDQsImV4cCI6MjA1MzMzODM0NH0.5oEKXRjAnm6hg1xRQivys6-ULdeBN5oUS3LSjAZumt8'
    );

    console.log('Supabase Instance:', _supabase);

    // Function to fetch data and display artwork
    async function fetchData() {
      const loadingElement = document.getElementById('loading');
      const wrapperElement = document.querySelector('.wrapper');
      const artworkDetails = document.getElementById('artwork-details');

      // Show the loading screen
      loadingElement.classList.remove('hidden');

      try {
        let { data, error } = await _supabase.rpc('get_today_artwork');
        if (error) {
          console.error('Error fetching artwork:', error);
          artworkDetails.innerHTML = '<p class="text-red-500">Failed to load artwork data.</p>';
        } else if (data) {
          console.log('Artwork data:', data);

          // Create and append the artwork details and image
          const title = document.createElement('h2');
          title.textContent = data.image_title || 'Untitled';
          title.className = 'title';

          const style = document.createElement('p');
          style.textContent = `Style: ${data.style || 'Unknown'}`;
          style.className = 'subtitle';

          const img = document.createElement('img');
          img.src = data.image_url;
          img.alt = data.image_title || 'Artwork Image';

          artworkDetails.appendChild(title);
          artworkDetails.appendChild(style);
          artworkDetails.appendChild(img);
        } else {
          artworkDetails.innerHTML = '<p class="text-gray-300">No artwork available for today.</p>';
        }
      } catch (err) {
        console.error('Unexpected error:', err);
        artworkDetails.innerHTML = '<p class="text-red-500">Failed to load artwork.</p>';
      } finally {
        // Hide the loading screen and show the content
        loadingElement.classList.add('hidden');
        wrapperElement.classList.remove('hidden');
      }
    }

    // Call the function
    fetchData();
  </script>
</body>

</html>
